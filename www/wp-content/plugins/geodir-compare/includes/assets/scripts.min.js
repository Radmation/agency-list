GD_Compare.loader=null;GD_Compare.addPopup=null;function geodir_compare_fetch(data){if(GD_Compare.addPopup){try{GD_Compare.addPopup.close()}catch(e){}try{GD_Compare.addPopup.remove()}catch(e$0){}}GD_Compare.loader=lity("loading");jQuery.get(GD_Compare.ajax_url,data).done(function(html){GD_Compare.addPopup=lity('<div class="lity-show">'+html+"</div>")}).fail(function(){GD_Compare.addPopup=lity('<div class="lity-show">'+GD_Compare.ajax_error+"</div>")}).always(function(){GD_Compare.loader.close()})}function geodir_compare_add($post_id,$post_type,openIn,baseUrl){if($post_id){var items={},in_compare=false;if(localStorage.GD_Compare_Items)items=JSON.parse(localStorage.GD_Compare_Items);if(!items[$post_type])items[$post_type]={};var data={action:"geodir_compare_get_items",post_type:$post_type,added:$post_id};if(items[$post_type][$post_id]==1){data.exists="1";in_compare=true}else items[$post_type][$post_id]=1;localStorage.GD_Compare_Items=JSON.stringify(items);data.items=localStorage.GD_Compare_Items;if(in_compare)if(openIn=="tab"||openIn=="window"){var comparePage=GD_Compare.comparePage;comparePage=comparePage.replace("compareids=0","compareids="+Object.keys(items[$post_type]).join());if(openIn=="window")window.open(comparePage,"_blank");else window.location=comparePage}else geodir_compare_fetch(data)}geodir_compare_update_states()}function geodir_compare_remove($post_id,$post_type){if($post_id){var items={};if(localStorage.GD_Compare_Items)items=JSON.parse(localStorage.GD_Compare_Items);if(items[$post_type]){delete items[$post_type][$post_id];localStorage.GD_Compare_Items=JSON.stringify(items)}var data={removed:$post_id,action:"geodir_compare_get_items",items:localStorage.GD_Compare_Items,post_type:$post_type};geodir_compare_update_states();geodir_compare_fetch(data)}}function geodir_compare_remove_from_table($post_id,$post_type){if($post_id){var items={},is_comparison_page=jQuery(".geodir-compare-page").length,listing_ids=[];if(localStorage.GD_Compare_Items)items=JSON.parse(localStorage.GD_Compare_Items);if(items[$post_type]&&items[$post_type][$post_id]){delete items[$post_type][$post_id];listing_ids=Object.keys(items[$post_type]);localStorage.GD_Compare_Items=JSON.stringify(items)}jQuery(".geodir-compare-"+$post_id).hide();jQuery(window).trigger("resize");geodir_compare_update_states();var urlQueryString=document.location.search,base_url=[location.protocol,"//",location.host,location.pathname].join(""),compareParams="compareids="+listing_ids.join();urlQueryString=urlQueryString.replace(new RegExp("\\bcompareids=[^&;]+[&;]?","gi"),compareParams);urlQueryString=urlQueryString.replace(/[&;]$/,"");if(is_comparison_page&&listing_ids.length)window.location=base_url+urlQueryString}}if(jQuery(".geodir-compare-page .geodir-compare-page-empty-list").length){var url=window.location.href;var items={};if(localStorage.GD_Compare_Items)items=JSON.parse(localStorage.GD_Compare_Items);if(window.location.href.indexOf("compareids=")==-1&&Object.keys(items).length){var post_type=Object.keys(items)[0],params="compareids="+Object.keys(items[post_type]).join(),base_url=[location.protocol,"//",location.host,location.pathname].join(""),urlQueryString=document.location.search;if(urlQueryString)params=urlQueryString+"&"+params;else params="?"+params;window.location=base_url+params}}function geodir_compare_get_meta(el){return{post_type:jQuery(el).data("geodir-compare-post_type"),post_id:jQuery(el).data("geodir-compare-post_id"),text:jQuery(el).data("geodir-compare-text"),icon:jQuery(el).data("geodir-compare-icon"),text2:jQuery(el).data("geodir-compared-text"),icon2:jQuery(el).data("geodir-compared-icon")}}function geodir_compare_update_states(){if(!localStorage.GD_Compare_Items)return;var items=JSON.parse(localStorage.GD_Compare_Items);jQuery(".geodir-compare-button").each(function(){var meta=geodir_compare_get_meta(this);if(items[meta.post_type]&&items[meta.post_type][meta.post_id]){jQuery(this).css("opacity","0.8");jQuery(this).find("i").removeClass(meta.icon).addClass(meta.icon2);jQuery(this).find(".gd-secondary").text(meta.text2)}else{jQuery(this).css("opacity","1");jQuery(this).find("i").removeClass(meta.icon2).addClass(meta.icon);jQuery(this).find(".gd-secondary").text(meta.text)}})}geodir_compare_update_states();